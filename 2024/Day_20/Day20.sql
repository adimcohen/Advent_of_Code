declare @Input varchar(max) =
'#############################################################################################################################################
#...............#...#...#...#.......#.............#.....###...###...#...#...#.......#...#...#.........###...###...###.......#...###...#...###
#.#############.#.#.#.#.#.#.#.#####.#.###########.#.###.###.#.###.#.#.#.#.#.#.#####.#.#.#.#.#.#######.###.#.###.#.###.#####.#.#.###.#.#.#.###
#.............#.#.#.#.#...#.#.#.....#...#.....#...#...#.....#...#.#.#.#.#.#.#.....#.#.#.#.#.#.......#...#.#.#...#...#.....#.#.#...#.#.#.#...#
#############.#.#.#.#.#####.#.#.#######.#.###.#.#####.#########.#.#.#.#.#.#.#####.#.#.#.#.#.#######.###.#.#.#.#####.#####.#.#.###.#.#.#.###.#
#...###.......#...#...#...#...#...#.....#...#.#...###.#.........#.#.#.#...#.#.....#.#.#.#.#.#...###.#...#.#.#...#...#.....#.#...#.#.#.#.#...#
#.#.###.###############.#.#######.#.#######.#.###.###.#.#########.#.#.#####.#.#####.#.#.#.#.#.#.###.#.###.#.###.#.###.#####.###.#.#.#.#.#.###
#.#...#...#...........#.#.....#...#.....#...#.....#...#.#...#...#.#.#.....#.#...#...#.#.#.#...#.#...#...#.#.#...#...#...#...#...#...#...#...#
#.###.###.#.#########.#.#####.#.#######.#.#########.###.#.#.#.#.#.#.#####.#.###.#.###.#.#.#####.#.#####.#.#.#.#####.###.#.###.#############.#
#...#.###...###...###...###...#...#...#.#.#...#...#.#...#.#...#.#.#.#.....#.#...#.....#...#.....#.....#...#.#.#.....#...#.....#...#...#...#.#
###.#.#########.#.#########.#####.#.#.#.#.#.#.#.#.#.#.###.#####.#.#.#.#####.#.#############.#########.#####.#.#.#####.#########.#.#.#.#.#.#.#
#...#.....#...#.#...###...#.....#.#.#.#.#.#.#.#.#.#.#...#.....#...#.#.....#.#.........#.....###...#...#.....#.#...#...#.........#...#...#.#.#
#.#######.#.#.#.###.###.#.#####.#.#.#.#.#.#.#.#.#.#.###.#####.#####.#####.#.#########.#.#######.#.#.###.#####.###.#.###.#################.#.#
#.......#...#...#...#...#.#.....#.#.#.#.#.#.#.#.#.#.#...#...#...#...#...#.#...#...###.#.....#...#.#.#...#...#.#...#.#...#...............#.#.#
#######.#########.###.###.#.#####.#.#.#.#.#.#.#.#.#.#.###.#.###.#.###.#.#.###.#.#.###.#####.#.###.#.#.###.#.#.#.###.#.###.#############.#.#.#
###...#.....#...#...#...#.#.....#.#.#.#.#.#.#.#.#.#.#.###.#.#...#...#.#...#...#.#...#.#.....#...#...#.....#.#.#...#.#.###.#.............#.#.#
###.#.#####.#.#.###.###.#.#####.#.#.#.#.#.#.#.#.#.#.#.###.#.#.#####.#.#####.###.###.#.#.#######.###########.#.###.#.#.###.#.#############.#.#
#...#.#...#...#...#...#.#.#.....#...#.#.#.#.#.#.#.#.#...#.#.#.....#...#.....###...#.#.#...#...#.....#.......#...#...#.....#.............#...#
#.###.#.#.#######.###.#.#.#.#########.#.#.#.#.#.#.#.###.#.#.#####.#####.#########.#.#.###.#.#.#####.#.#########.#######################.#####
#...#...#.#.....#...#...#.#.#...#...#.#.#...#.#.#.#.#...#.#.#...#.....#.#...###...#.#.#...#.#.#.....#.###.....#...#.....................#...#
###.#####.#.###.###.#####.#.#.#.#.#.#.#.#####.#.#.#.#.###.#.#.#.#####.#.#.#.###.###.#.#.###.#.#.#####.###.###.###.#.#####################.#.#
#...#...#.#...#...#.....#.#...#...#.#.#...#...#.#.#.#.#...#...#.#...#.#...#...#...#...#...#.#.#.....#...#...#.#...#.#...............#.....#.#
#.###.#.#.###.###.#####.#.#########.#.###.#.###.#.#.#.#.#######.#.#.#.#######.###.#######.#.#.#####.###.###.#.#.###.#.#############.#.#####.#
#.....#.#.###...#...###.#.###...#...#.....#...#.#...#.#.#.......#.#.#.#.......###.....#...#.#...#...#...#...#.#.#...#.#.........#...#...#...#
#######.#.#####.###.###.#.###.#.#.###########.#.#####.#.#.#######.#.#.#.#############.#.###.###.#.###.###.###.#.#.###.#.#######.#.#####.#.###
#...#...#...###...#.....#...#.#.#.........#...#.....#...#...#...#.#...#.....###...###.#.....#...#...#...#.#...#.#...#.#.......#...#...#.#...#
#.#.#.#####.#####.#########.#.#.#########.#.#######.#######.#.#.#.#########.###.#.###.#######.#####.###.#.#.###.###.#.#######.#####.#.#.###.#
#.#.#...#...#.....#...#...#...#...###...#.#.#...#...#.......#.#.#.....#.....#...#...#...#.....#...#.#...#.#.###.#...#.#.......#...#.#.#.#...#
#.#.###.#.###.#####.#.#.#.#######.###.#.#.#.#.#.#.###.#######.#.#####.#.#####.#####.###.#.#####.#.#.#.###.#.###.#.###.#.#######.#.#.#.#.#.###
#.#.#...#...#.......#...#.......#...#.#...#.#.#.#.#...#...###.#.###...#...###.....#...#.#...###.#...#.#...#.....#.#...#.........#.#.#...#...#
#.#.#.#####.###################.###.#.#####.#.#.#.#.###.#.###.#.###.#####.#######.###.#.###.###.#####.#.#########.#.#############.#.#######.#
#.#.#...#...#...#...###...#...#.#...#.#...#.#.#.#.#...#.#.#...#...#.....#...#...#...#.#...#.#...#.....#...#.......#.#.............#.#.......#
#.#.###.#.###.#.#.#.###.#.#.#.#.#.###.#.#.#.#.#.#.###.#.#.#.#####.#####.###.#.#.###.#.###.#.#.###.#######.#.#######.#.#############.#.#######
#.#.#...#...#.#.#.#.#...#...#...#...#...#.#.#.#.#.#...#.#.#.#.....#...#.#...#.#.###.#.###.#.#...#.#...#...#.........#.............#.#.......#
#.#.#.#####.#.#.#.#.#.#############.#####.#.#.#.#.#.###.#.#.#.#####.#.#.#.###.#.###.#.###.#.###.#.#.#.#.#########################.#.#######.#
#.#...#.....#.#.#.#.#.............#...#...#.#.#.#.#.#...#.#.#.....#.#.#.#.#...#...#.#...#.#.#...#...#.#.#.......................#...#...#...#
#.#####.#####.#.#.#.#############.###.#.###.#.#.#.#.#.###.#.#####.#.#.#.#.#.#####.#.###.#.#.#.#######.#.#.#####################.#####.#.#.###
#.#...#.....#.#.#.#.........#...#...#.#.#...#.#.#.#.#.###.#...#...#.#.#.#.#...###.#.#...#.#.#.......#.#.#.....................#.#...#.#...###
#.#.#.#####.#.#.#.#########.#.#.###.#.#.#.###.#.#.#.#.###.###.#.###.#.#.#.###.###.#.#.###.#.#######.#.#.#####################.#.#.#.#.#######
#.#.#.#...#...#.#...#.....#...#.....#...#...#.#.#.#.#.#...#...#...#.#...#.....#...#.#...#.#.#...#...#.#.#.....................#.#.#.#.......#
#.#.#.#.#.#####.###.#.###.#################.#.#.#.#.#.#.###.#####.#.###########.###.###.#.#.#.#.#.###.#.#.#####################.#.#.#######.#
#.#.#...#.....#.###...#...#.....#.........#.#.#.#.#...#...#.#...#.#.......#.....#...#...#.#...#.#...#...#...###.........#...###...#...#...#.#
#.#.#########.#.#######.###.###.#.#######.#.#.#.#.#######.#.#.#.#.#######.#.#####.###.###.#####.###.#######.###.#######.#.#.#########.#.#.#.#
#.#.#.........#.........#...###...#.......#.#.#.#.#.......#.#.#.#.....#...#...#...###...#.#.....#...#.......#...#.....#...#...#.....#.#.#.#.#
#.#.#.###################.#########.#######.#.#.#.#.#######.#.#.#####.#.#####.#.#######.#.#.#####.###.#######.###.###.#######.#.###.#.#.#.#.#
#...#.........#...........#.........#...###.#.#.#.#.#.....#...#.....#.#.#.....#...#.....#.#.#.....###.........#...###.........#.#...#...#.#.#
#############.#.###########.#########.#.###.#.#.#.#.#.###.#########.#.#.#.#######.#.#####.#.#.#################.###############.#.#######.#.#
#...#...#...#...#...###...#...........#...#.#.#.#.#.#.#...#...#.....#...#...#.....#.#...#.#.#.#...###...#...#...#...#.....#...#.#.###...#...#
#.#.#.#.#.#.#####.#.###.#.###############.#.#.#.#.#.#.#.###.#.#.###########.#.#####.#.#.#.#.#.#.#.###.#.#.#.#.###.#.#.###.#.#.#.#.###.#.#####
#.#...#...#.......#.....#.###...###...#...#...#...#.#.#...#.#.#.........###...#...#...#...#...#.#.....#...#.#.....#.#.#...#.#...#.....#.....#
#.#######################.###.#.###.#.#.###########.#.###.#.#.#########.#######.#.#############.###########.#######.#.#.###.###############.#
#.........#.....#...#...#.....#...#.#...###.......#.#...#.#.#.#.........#...#...#.###...###...#...........#.#.......#.#.#...#...#...#...#...#
#########.#.###.#.#.#.#.#########.#.#######.#####.#.###.#.#.#.#.#########.#.#.###.###.#.###.#.###########.#.#.#######.#.#.###.#.#.#.#.#.#.###
#...#.....#.#...#.#...#...#.....#...#.......#...#.#.#...#...#.#.......#...#.#...#...#.#.....#.###.......#.#.#.........#...#...#...#...#...###
#.#.#.#####.#.###.#######.#.###.#####.#######.#.#.#.#.#######.#######.#.###.###.###.#.#######.###.#####.#.#.###############.#################
#.#.#.....#.#.....#...#...#...#.....#.#.......#...#...#.......#.....#...#...###...#...#.....#.....#...#...#.................#...#...#...#...#
#.#.#####.#.#######.#.#.#####.#####.#.#.###############.#######.###.#####.#######.#####.###.#######.#.#######################.#.#.#.#.#.#.#.#
#.#.#...#...#.......#.#.......#...#...#.....#...#...###.....#...###.#...#.###...#.....#...#...#...#.#.#...#...#...#...........#...#...#...#.#
#.#.#.#.#####.#######.#########.#.#########.#.#.#.#.#######.#.#####.#.#.#.###.#.#####.###.###.#.#.#.#.#.#.#.#.#.#.#.#######################.#
#.#...#.#...#.......#...###...#.#.....#...#...#...#...#.....#.....#.#.#.#...#.#.#.....#...###...#...#...#...#...#...#.................#.....#
#.#####.#.#.#######.###.###.#.#.#####.#.#.###########.#.#########.#.#.#.###.#.#.#.#####.#############################.###############.#.#####
#.....#.#.#.#...###...#.....#...#...#...#...#...#...#.#...#...#...#.#.#.#...#.#...#...#...#.......#.............#...#...........#...#...#...#
#####.#.#.#.#.#.#####.###########.#.#######.#.#.#.#.#.###.#.#.#.###.#.#.#.###.#####.#.###.#.#####.#.###########.#.#.###########.#.#.#####.#.#
#.....#...#...#.#...#.............#.......#.#.#...#...#...#.#...###...#.#.###.......#.#...#.....#.#.......#...#...#.#...#.......#.#.......#.#
#.#############.#.#.#####################.#.#.#########.###.###########.#.###########.#.#######.#.#######.#.#.#####.#.#.#.#######.#########.#
#.............#.#.#.#...#.........#...#...#...###.....#...#.#...........#...#.........#.....#...#...#...#...#.#...#.#.#.#.........#.......#.#
#############.#.#.#.#.#.#.#######.#.#.#.#########.###.###.#.#.#############.#.#############.#.#####.#.#.#####.#.#.#.#.#.###########.#####.#.#
#.............#...#.#.#.#.......#...#...#...#...#.#...#...#.#...#...#.....#.#.#.....#...#...#.#...#...#.#...#...#.#...#.............#...#...#
#.#################.#.#.#######.#########.#.#.#.#.#.###.###.###.#.#.#.###.#.#.#.###.#.#.#.###.#.#.#####.#.#.#####.###################.#.#####
#...#...#.........#...#...#...#...........#...#...#...#...#.###...#.#.#...#.#...###.#.#...###...#.....#...#.......#...#...............#.....#
###.#.#.#.#######.#######.#.#.#######################.###.#.#######.#.#.###.#######.#.###############.#############.#.#.###################.#
###...#...#.....#.......#.#.#.#...#.............#...#...#...#.....#...#...#...#...#...#...#...#...###.............#.#...#...#.......#.....#.#
###########.###.#######.#.#.#.#.#.#.###########.#.#.###.#####.###.#######.###.#.#.#####.#.#.#.#.#.###############.#.#####.#.#.#####.#.###.#.#
#.........#...#.#.......#...#...#...#.........#...#.....#...#...#...#...#.....#.#.#...#.#.#.#.#.#.#...............#.#.....#...#...#...###...#
#.#######.###.#.#.###################.#######.###########.#.###.###.#.#.#######.#.#.#.#.#.#.#.#.#.#.###############.#.#########.#.###########
#.....#...###.#.#.....#...............#.......#.........#.#...#...#.#.#.....#...#...#...#.#.#.#.#.#...#.......###...#...........#...........#
#####.#.#####.#.#####.#.###############.#######.#######.#.###.###.#.#.#####.#.###########.#.#.#.#.###.#.#####.###.#########################.#
#.....#...#...#.#...#...#...............#.......#.......#...#.#...#.#.....#.#.#.........#.#.#...#.###...#...#.#...#...#...#...#.............#
#.#######.#.###.#.#.#####.###############.#######.#########.#.#.###.#####.#.#.#.#######.#.#.#####.#######.#.#.#.###.#.#.#.#.#.#.#############
#.#.....#.#...#...#...###...#############E#.......#...#...#.#.#.#...###...#.#...###.....#...#...#...#.....#...#.#...#...#...#...#...........#
#.#.###.#.###.#######.#####.###############.#######.#.#.#.#.#.#.#.#####.###.#######.#########.#.###.#.#########.#.###############.#########.#
#...#...#.....#.....#.#.....#############...#...###.#.#.#.#.#...#.#...#...#.#.....#...........#...#...#.........#.....###...#...#...#.......#
#####.#########.###.#.#.#################.###.#.###.#.#.#.#.#####.#.#.###.#.#.###.###############.#####.#############.###.#.#.#.###.#.#######
#.....#...#...#.#...#...#################.....#.....#.#.#.#.#.....#.#...#.#.#...#.....###...#...#.......#...#...#...#.....#...#.....#...#...#
#.#####.#.#.#.#.#.###################################.#.#.#.#.#####.###.#.#.###.#####.###.#.#.#.#########.#.#.#.#.#.###################.#.#.#
#.#...#.#...#...#.#.....#####...................#.....#.#.#.#.....#...#.#.#...#.....#.#...#...#...........#...#.#.#.#...#.............#...#.#
#.#.#.#.#########.#.###.#####.#################.#.#####.#.#.#####.###.#.#.###.#####.#.#.#######################.#.#.#.#.#.###########.#####.#
#.#.#.#.#.....#...#.#...#####...#...#...#...###...#...#.#...#.....#...#.#.#...###...#.#...........#...........#.#.#...#.#...........#.......#
#.#.#.#.#.###.#.###.#.#########.#.#.#.#.#.#.#######.#.#.#####.#####.###.#.#.#####.###.###########.#.#########.#.#.#####.###########.#########
#.#.#.#.#...#...#...#.#S#######...#...#...#...#...#.#...#.....#...#...#.#.#.#.....#...#.......###...#.........#...###...#...#.....#.........#
#.#.#.#.###.#####.###.#.#####################.#.#.#.#####.#####.#.###.#.#.#.#.#####.###.#####.#######.###############.###.#.#.###.#########.#
#...#...#...#...#.#...#.#...#...............#...#.#.....#...#...#...#.#...#.#...#...###.....#.#...###...............#.....#...###...........#
#########.###.#.#.#.###.#.#.#.#############.#####.#####.###.#.#####.#.#####.###.#.#########.#.#.#.#################.#########################
#.........#...#...#.....#.#...#...........#.......#.....#...#.#...#.#...#...#...#.#...###...#.#.#.#.................#...###...###...........#
#.#########.#############.#####.#########.#########.#####.###.#.#.#.###.#.###.###.#.#.###.###.#.#.#.#################.#.###.#.###.#########.#
#.....#.....###...........#.....###.....#.#.....###.....#.....#.#...#...#...#...#.#.#...#...#.#.#.#...................#.....#...#.#.........#
#####.#.#######.###########.#######.###.#.#.###.#######.#######.#####.#####.###.#.#.###.###.#.#.#.#############################.#.#.#########
#...#...#.......#.....#...#.#.......###.#.#...#...###...#.......###...#...#.#...#.#...#...#.#...#.....###...#...#...#...#.....#...#...#.....#
#.#.#####.#######.###.#.#.#.#.#########.#.###.###.###.###.#########.###.#.#.#.###.###.###.#.#########.###.#.#.#.#.#.#.#.#.###.#######.#.###.#
#.#.#...#...#...#.#...#.#.#.#.........#...###...#.....#...#.......#.....#.#.#.#...###...#.#.....#.....#...#...#...#.#.#.#...#...#...#...#...#
#.#.#.#.###.#.#.#.#.###.#.#.#########.#########.#######.###.#####.#######.#.#.#.#######.#.#####.#.#####.###########.#.#.###.###.#.#.#####.###
#.#...#.###...#...#.....#...###...#...###...#...#.......###.....#...#...#.#.#.#.......#.#.#.....#...###.........#...#.#.....#...#.#.#.....###
#.#####.#######################.#.#.#####.#.#.###.#############.###.#.#.#.#.#.#######.#.#.#.#######.###########.#.###.#######.###.#.#.#######
#.....#.............###...###...#...#...#.#.#...#.###...###...#...#.#.#.#.#.#.#.......#.#.#.....#...#...#.......#...#.###...#...#.#.#.......#
#####.#############.###.#.###.#######.#.#.#.###.#.###.#.###.#.###.#.#.#.#.#.#.#.#######.#.#####.#.###.#.#.#########.#.###.#.###.#.#.#######.#
#...#.#...#.......#.....#.....#.....#.#.#.#.#...#...#.#...#.#.#...#.#.#.#.#.#.#.#.....#.#.#...#.#...#.#.#.#...#...#...#...#...#.#.#.#.......#
#.#.#.#.#.#.#####.#############.###.#.#.#.#.#.#####.#.###.#.#.#.###.#.#.#.#.#.#.#.###.#.#.#.#.#.###.#.#.#.#.#.#.#.#####.#####.#.#.#.#.#######
#.#...#.#...#.....#...........#.#...#.#.#.#.#.#.....#...#.#.#.#...#.#.#...#.#.#.#.###...#.#.#.#...#.#.#.#...#...#.#...#...#...#...#...#.....#
#.#####.#####.#####.#########.#.#.###.#.#.#.#.#.#######.#.#.#.###.#.#.#####.#.#.#.#######.#.#.###.#.#.#.#########.#.#.###.#.###########.###.#
#.#...#.#.....#...#...#.......#.#...#.#.#.#.#.#.#.....#.#.#.#...#.#.#.....#.#.#.#.....###.#.#.#...#...#.#...#...#...#.....#.#...#...###.#...#
#.#.#.#.#.#####.#.###.#.#######.###.#.#.#.#.#.#.#.###.#.#.#.###.#.#.#####.#.#.#.#####.###.#.#.#.#######.#.#.#.#.###########.#.#.#.#.###.#.###
#...#...#.......#...#.#.#...#...###.#.#.#.#.#.#.#.#...#.#...#...#.#...#...#.#.#.#...#...#...#.#.#.......#.#.#.#.......#...#...#...#.....#...#
###################.#.#.#.#.#.#####.#.#.#.#.#.#.#.#.###.#####.###.###.#.###.#.#.#.#.###.#####.#.#.#######.#.#.#######.#.#.#################.#
#...#.........#...#.#.#.#.#.#.#.....#.#...#...#.#.#...#.#.....#...###.#...#.#.#.#.#...#.#...#...#.....#...#...#.......#.#...#.......#...#...#
#.#.#.#######.#.#.#.#.#.#.#.#.#.#####.#########.#.###.#.#.#####.#####.###.#.#.#.#.###.#.#.#.#########.#.#######.#######.###.#.#####.#.#.#.###
#.#.#.......#...#...#.#...#.#.#.....#.......#...#.###...#...#...#.....#...#.#.#.#...#.#...#.#...#...#.#.....###...#...#...#...#...#...#.#.###
#.#.#######.#########.#####.#.#####.#######.#.###.#########.#.###.#####.###.#.#.###.#.#####.#.#.#.#.#.#####.#####.#.#.###.#####.#.#####.#.###
#.#.........#...#...#...#...#.#.....#...#...#...#...#.......#...#.....#.#...#.#.....#.....#.#.#...#...#...#.....#.#.#...#.......#.....#.#...#
#.###########.#.#.#.###.#.###.#.#####.#.#.#####.###.#.#########.#####.#.#.###.###########.#.#.#########.#.#####.#.#.###.#############.#.###.#
#.#...#.....#.#...#.#...#...#.#...#...#.#...###...#.#.....#...#.....#.#.#...#.#...........#.#.....#...#.#.#...#.#...###...#.....#...#.#.#...#
#.#.#.#.###.#.#####.#.#####.#.###.#.###.###.#####.#.#####.#.#.#####.#.#.###.#.#.###########.#####.#.#.#.#.#.#.#.#########.#.###.#.#.#.#.#.###
#.#.#.#.#...#.#.....#.#.....#.###.#.###...#...###.#...#...#.#...#...#.#.#...#.#.....#.....#.#.....#.#.#.#...#...#.....#...#...#.#.#.#.#.#...#
#.#.#.#.#.###.#.#####.#.#####.###.#.#####.###.###.###.#.###.###.#.###.#.#.###.#####.#.###.#.#.#####.#.#.#########.###.#.#####.#.#.#.#.#.###.#
#.#.#.#.#.#...#.....#.#.#.....#...#...###...#...#...#.#...#.###...###...#.#...###...#...#.#.#.....#.#.#...........#...#.#...#.#.#.#...#...#.#
#.#.#.#.#.#.#######.#.#.#.#####.#####.#####.###.###.#.###.#.#############.#.#####.#####.#.#.#####.#.#.#############.###.#.#.#.#.#.#######.#.#
#.#.#...#...###...#...#...###...#...#...###.....###...###.#.......#.......#.#.....#...#.#.#.#...#...#...#...........###.#.#...#.#...#.....#.#
#.#.###########.#.###########.###.#.###.#################.#######.#.#######.#.#####.#.#.#.#.#.#.#######.#.#############.#.#####.###.#.#####.#
#...#...........#.............#...#...#.........#...#.....#...#...#.......#.#.#...#.#.#.#.#...#...#.....#.............#.#.....#.#...#.....#.#
#####.#########################.#####.#########.#.#.#.#####.#.#.#########.#.#.#.#.#.#.#.#.#######.#.#################.#.#####.#.#.#######.#.#
#.....#...#...#...#...#...#...#.....#.#...#...#...#.#.....#.#...###.......#.#.#.#.#.#.#.#...#...#.#.#...#...#.....#...#.#...#.#.#.#.....#.#.#
#.#####.#.#.#.#.#.#.#.#.#.#.#.#####.#.#.#.#.#.#####.#####.#.#######.#######.#.#.#.#.#.#.###.#.#.#.#.#.#.#.#.#.###.#.###.#.#.#.#.#.#.###.#.#.#
#...#...#...#...#.#.#.#.#.#.#.....#.#...#.#.#.#...#.#.....#...#.....#.....#.#.#.#...#.#...#.#.#.#.#.#.#.#.#.#...#.#...#.#.#...#.#...#...#.#.#
###.#.###########.#.#.#.#.#.#####.#.#####.#.#.#.#.#.#.#######.#.#####.###.#.#.#.#####.###.#.#.#.#.#.#.#.#.#.###.#.###.#.#.#####.#####.###.#.#
#...#...#...#.....#.#.#.#.#...#...#...###...#.#.#.#.#.....#...#.#...#.#...#.#.#.....#.#...#...#.#.#.#.#.#.#.#...#.#...#.#.....#.#...#.#...#.#
#.#####.#.#.#.#####.#.#.#.###.#.#####.#######.#.#.#.#####.#.###.#.#.#.#.###.#.#####.#.#.#######.#.#.#.#.#.#.#.###.#.###.#####.#.#.#.#.#.###.#
#.#.....#.#.#...#...#.#.#.....#...#...#.....#.#.#...###...#...#.#.#...#.....#...#...#...###...#...#.#.#.#.#.#...#.#...#.#...#.#.#.#...#.....#
#.#.#####.#.###.#.###.#.#########.#.###.###.#.#.#######.#####.#.#.#############.#.#########.#.#####.#.#.#.#.###.#.###.#.#.#.#.#.#.###########
#.#.#.....#.....#.#...#.#.........#.....#...#.#...#.....#...#.#.#...#...........#...........#...#...#.#.#.#.#...#...#.#.#.#.#.#.#...........#
#.#.#.###########.#.###.#.###############.###.###.#.#####.#.#.#.###.#.#########################.#.###.#.#.#.#.#####.#.#.#.#.#.#.###########.#
#...#.............#.....#.................###.....#.......#...#.....#...........................#.....#...#...#####...#...#...#.............#
#############################################################################################################################################'

drop table if exists AOC_2024_Day21_Map
drop table if exists AOC_2024_Day21_Edges
drop table if exists #Routes
drop table if exists #Steps

create table AOC_2024_Day21_Map
	(r tinyint,
	c tinyint,
	Val char(1)
	) as node
create unique clustered index IX_AOC_2024_Day21_Map on AOC_2024_Day21_Map($node_id)
create unique index IX_AOC_2024_Day21_Map1 on AOC_2024_Day21_Map(r, c)

create table AOC_2024_Day21_Edges as edge
create unique clustered index IX_AOC_2024_Day21_Edges on AOC_2024_Day21_Edges($from_id, $to_id)
create unique index IX_AOC_2024_Day21_Edges1 on AOC_2024_Day21_Edges($to_id, $from_id)

;with i as
	(select r.ordinal - 1 r, c.[value] - 1 c, cast(substring(r.[value], c.[value], 1) as char(1)) Val, max(r.ordinal) over() - 2 MaxR, max(c.[value]) over() - 2 MaxC
		from string_split(replace(@Input, char(10), ''), char(13), 1) r
			cross apply generate_series(cast(1 as int), cast(len(r.[value]) as int), cast(1 as int)) c
	)
insert into AOC_2024_Day21_Map
select r, c, Val
from i
where Val != '#'
	
insert into AOC_2024_Day21_Edges
select a.$node_id, b.$node_id
from AOC_2024_Day21_Map a
	inner join AOC_2024_Day21_Map b on ((b.c = a.c and b.r in (a.r - 1, a.r + 1))
										or (b.r = a.r and b.c in (a.c - 1, a.c + 1))
										)

alter index all on AOC_2024_Day21_Edges rebuild

select last_value(i1.Val) within group (graph path) LastVal,
	string_agg(cast(concat(i1.r, '.', i1.c) as varchar(max)), ',') within group (graph path) Rt,
	len(string_agg(cast(isnull(nullif(i1.r, i1.r), '1') as varchar(max)), '') within group (graph path)) TotalSteps
into #Routes
from AOC_2024_Day21_Map i,
	AOC_2024_Day21_Edges for path e,
	AOC_2024_Day21_Map for path i1
where MATCH(shortest_path(i(-(e)->i1)+))
	and i.Val = 'S'

select TotalSteps, r, c, ordinal Dist
into #Steps
from #Routes
	cross apply string_split(Rt, ',', 1)
	cross apply (select cast(parsename([value], 2) as int) r, cast(parsename([value], 1) as int) c) p
where LastVal = 'E'
union all
select TotalSteps, r, c, 0
from AOC_2024_Day21_Map
	inner join #Routes on LastVal = 'E'
where Val = 'S'

create unique clustered index IX_#Steps on #Steps(r, c)

select count(*) Answer1
from #Steps a
	inner join #Steps b on a.Dist < b.Dist
	cross apply (select abs(b.c - a.c) + abs(b.r - a.r) Cheat) c
	cross apply (select b.Dist - a.Dist - Cheat Diff) d
where Diff >= 100
	and a.Dist < b.Dist - Cheat
	and Cheat = 2

select count(*) Answer2
from #Steps a
	inner join #Steps b on a.Dist < b.Dist
	cross apply (select abs(b.c - a.c) + abs(b.r - a.r) Cheat) c
	cross apply (select b.Dist - a.Dist - Cheat Diff) d
where Diff >= 100
	and a.Dist < b.Dist - Cheat
	and Cheat <= 20